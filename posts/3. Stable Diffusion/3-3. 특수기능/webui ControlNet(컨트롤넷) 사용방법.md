 **Stable Diffusion webui의 무한한 확장 가능성 Controlnet(컨트롤넷) 기능부터 사용방법까지** 안녕하세요 Allan입니다. 이번 포스팅 주제는 webui의 Exstension 중 하나인 Controlnet(컨트롤넷)입니다. 보통 Controlnet 하면 자세 지정해 주는 기능으로 알고 계시는 분들이 많은데 (제가 그랬음) 그건 Controlnet의 종류 중 하나인 openpose의 기능입니다. 그럼 Controlnet이 도대체 무엇인지, 그리고 각각 무슨 기능을 하는지, 어떻게 사용하는지 알아보도록 하겠습니다. controlnet 설치 방법을 모르신다면, 혹은 아직 설치하지 않으셨다면 아래 포스팅을 보고 오시는 것을 추천드립니다. [[webui openpose로 원하는 자세로 이미지를 생성해보기 DesignerAllan]]
 ![](https://scrap.kakaocdn.net/dn/cfTSTI/hyRXzg4lH4/l2htDRJ2BDgAK6KcNu8SaK/img.png?width=512&height=512&face=232_99_349_216,https://scrap.kakaocdn.net/dn/bgdAPx/hyRXyCsOPP/u8ndUOZA0Q7w7n2S1ewlfk/img.png?width=935&height=715&face=0_0_935_715) 

 # Ⅰ. ControlNet(컨트롤넷)이란?
- ControlNet is a neural network structure to control diffusion models by adding extra conditions. 
- 사실 저도 전공자가 아니기 때문에 자세한 의미는 모릅니다만, 대강 해석해 보면 "추가적인 조건을 추가하여 디퓨전 모델을 컨트롤하는 신경망 구조"라는 뜻입니다. webui를 단지 사용하는 사용자 입장에서 자세한 뜻은 알지 못해도 괜찮으므로 diffusion model을 제어해 주는 역할을 하는 친구라고 생각하고 넘어가도록 하겠습니다. 

 # Ⅱ. ControlNet 옵션값 설정
 ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdcfPCA%2Fbtr4slyRsE0%2FCuk0sBl7Hqk3Sq83Kgqu60%2Fimg.png) 
 
 - 맨 위에서 부터 순서대로 알아보겠습니다. 
- 1. **Enable**만 체크하고 넘어가 줍니다. Vram이 8기가 이하이신 분들은 **Low VRAM**도 체크하시는 것을 추천드립니다. 
- 2. **Preprocessor**에서 어떤 Controlnet을 사용할지 선택해 줍니다. **Model**에서는 Preprocessor에 맞는 다운받은 모델을 선택해 주시면 됩니다. 
- 3. **Weight** : ControlNet으로 추출한 데이터를 생성할 이미지에 얼마나 많이 반영할 것인지 조절하는 기능입니다. 예를들면 1보다 더 높으면 현재보다 더 많이 반영하게 될 것입니다. Guidance는 0,1그대로 둡니다. 
- 4. **Annotator Resolution** : 데이터의 해상도를 얼마나 좋게 할지 설정합니다. 선택한 모델에 따라서 Annotator가 아니라 다른 단어인 경우도 있습니다. 다만, Resolution을 높인다고 무조건 좋은 것은 아니므로 적절하게 설정하는 것이 중요합니다. 처음 사용하시는 분은 512그대로 두시는 것을 추천드립니다. 
- 5. **Threshold A, B :** 추출한 데이터에 영향을 주는 기능인 것 같은데 정확하게 어떤 기능이다! 라고 말씀 못드리는 점 죄송합니다.. 그냥 기본값으로 설정하시는 것을 추천 드립니다. 
- 6. **Resize Mode** : 왼쪽이랑 오른쪽 거는 짤리거나 찌그러지거나 하기 때문에 무조건 Scale to fit 체크하시는 것을 추천드립니다. 
- 7. Canvas Width, Canvas Height : 추출한 데이터 이미지의 사이즈를 조절하는 기능입니다. 별로 신경안쓰셔도 됩니다. 
# Ⅲ. ControlNet의 종류/기능
 webui를 켜셔서 Controlnet을 열어서 preprocessor를 클릭해 보면 다음과 같이 여러 항목들이 있는 것을 볼 수 있습니다.
  ![ControlNet preprocessor](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FlTqeg%2Fbtr4iTpiioq%2FkwQj81CMSW9fj9pvXM3oTk%2Fimg.png) 
  여기에 있는 모든 모델들을 설명해 드리지는 못할 것 같고  자주 사용되는 몇몇만 소개해 드리도록 하겠습니다. 다운은 아래 사이트에서 받을 수 있습니다. [https://huggingface.co/lllyasviel/ControlNet/tree/main/models](https://huggingface.co/lllyasviel/ControlNet/tree/main/models) [https://civitai.com/models/9251/controlnet-pre-trained-models](https://civitai.com/models/9251/controlnet-pre-trained-models) 첫 번째는 원본모델이고 두 번째는 압축모델입니다. 원본 모델은 전부 다 다운로드하면 50기가가 넘어가니 용량 여유 있으시면 다운 받으시고 50기가가 너무 무거우시다면 아래 모델별 설명 보시고 사용할 모델만 다운 받거나 두 번째 사이트에서 압축모델을 다운받으시는 것을 추천드립니다. 모델 다운받고 설치하는 방법은 포스팅 상단에 링크된 게시글에 설명해 놓았으니 참고해 주세요. 이미지를 통해서 각각이 어떤 기능을 하는지 직접 보도록 하겠습니다. 모든 이미지의 출처는 아래 링크입니다. [https://github.com/lllyasviel/ControlNet](https://github.com/lllyasviel/ControlNet) 자세한 내용 참고하시면 될 것 같습니다. 앞으로 나올 8개의 이미지의 이해를 돕기 위해서 설명을 해드리자면, 좌측은 ControlNet을 통해 데이터를 추출을 할 이미지이고 우측 첫 번째 이미지는 추출된 데이터 이미지(앞으로 result라 하겠습니다.), 그리고 첫 번째를 제외한 우측의 모든 이미지는 result를 기반으로 생성된 이미지 들입니다. 또한 이번 포스팅에서는 각각 어떤 기능을 하는지 대략적인 설명만 해 드리고 사용방법에 대해서는 차차 포스팅하여 링크를 걸어 두도록 하겠습니다. ### [1\. Canny](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#1.%20Canny-1) ![Canny](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcrBm4F%2Fbtr4hP8warN%2F8btepT2xsCOD8OrVuKjT50%2Fimg.png) 우측 첫 번째 이미지를 보시면 스케치한 것 같은 이미지가 있습니다. 주어진 이미지를 스케치한 듯한 result로 바꿔주고 그를 통해서 이미지를 생성하는 방법입니다. 스케치 형태의 result를 기반으로 이미지가 생성되기 때문에이미지의 그림체는 비슷하고 색감이나 질감등을 바꾸는데 유용하게 사용됩니다. Canny 사용방법 [webui ControlNet(컨트롤넷) - Canny 사용방법 완벽정리](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-Canny-%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95-%EC%99%84%EB%B2%BD%EC%A0%95%EB%A6%AC) [ webui ControlNet(컨트롤넷) - Canny 사용방법 완벽정리 webui ControlNet(컨트롤넷) Canny 를 이용하여 원하는 이미지 생성해 보기 안녕하세요 Allan입니다. 이번 포스팅 주제는 ControlNet의 종류 중 하나인 Canny입니다. Canny는 주어진 그림을 스케치형식으로 따 ai-designer-allan.tistory.com ](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-Canny-%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95-%EC%99%84%EB%B2%BD%EC%A0%95%EB%A6%AC)![](https://scrap.kakaocdn.net/dn/BHPWo/hyRXrLvV4a/He8x7gQYG1vM91PU6pZTPk/img.png?width=704&height=512&face=0_0_704_512,https://scrap.kakaocdn.net/dn/Pjx2X/hyRY6Z3yDZ/9wrG2GDkNKuEmeeUSrt3j0/img.png?width=704&height=512&face=0_0_704_512,https://scrap.kakaocdn.net/dn/cG5GuA/hyRXCM3C4U/Kck925fxyb49hYapt4lwL1/img.png?width=915&height=673&face=0_0_915_673) ### [2\. Depth](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#2.%20Depth-1) ![Depth](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdtm05p%2Fbtr4gU3qfDl%2FL15mOYyZIxvpxTrfOI7fMk%2Fimg.png) Depth는 말 그대로 깊이를 표현하는 result가 추출됩니다. 보시는 것처럼 기반이 되는 이미지와 거의 동일한 구도로 이미지가 생성되는 것을 볼 수 있습니다. Canny가 스케치 형태의 result이라면 Depth는 입체감을 표현해 주는 result를 추출하기 때문에 입체감을 재현하는 데 있어 더 유리하다고 볼 수 있습니다. [스테이블 디퓨전 ControlNet : Depth 사용방법 총정리](https://ai-designer-allan.tistory.com/entry/%EC%8A%A4%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%94%94%ED%93%A8%EC%A0%84-ControlNet-Depth-%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95-%EC%B4%9D%EC%A0%95%EB%A6%AC) [ 스테이블 디퓨전 ControlNet : Depth 사용방법 총정리 ControlNet 종류 중 하나인 Depth의 사용방법에 대한 상세한 설명 안녕하세요 Allan입니다. 이번 포스팅 주제는 ControlNet의 종류 중 하나인 Depth입니다. Depth는 레퍼런스 이미지의 깊이감을 추출한 이미 ai-designer-allan.tistory.com ](https://ai-designer-allan.tistory.com/entry/%EC%8A%A4%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%94%94%ED%93%A8%EC%A0%84-ControlNet-Depth-%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95-%EC%B4%9D%EC%A0%95%EB%A6%AC)![](https://scrap.kakaocdn.net/dn/OdScP/hyR5xLyVBJ/NWI2OKYXkasMQVDlf5t7KK/img.png?width=512&height=512&face=0_0_512_512,https://scrap.kakaocdn.net/dn/hz6TO/hyR5noDpZY/hESyBSbE5jLoTzV7rxTtM0/img.png?width=512&height=512&face=0_0_512_512,https://scrap.kakaocdn.net/dn/bLkOIa/hyR5pNvNNw/g2kunJGd9XY8FJerPLt0I0/img.png?width=576&height=576&face=0_0_576_576) ### [3\. HED](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#3.%20HED%C2%A0-1)  ![HED](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbmZGgL%2Fbtr4guYkc6F%2F00BDpMTZ7JC6VKg4cjMkM0%2Fimg.png) HED는 Cany와 비슷한 느낌으로 이미지를 생성할 수 있습니다. result가 색을 빼는 느낌이라 색감만 다르게 그림을 재생성하는데 적합합니다. ### [4\. M-LSD](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#4.%20M-LSD-1) ![M-LSD](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FVjfyg%2Fbtr4gUiaRN2%2FN453wyMJRAXk397phYKxok%2Fimg.png) MLSD는 직선을 감지하여 직선만 추출해 주는 형태의 result를 생성합니다. 보시는 것처럼 인테리어 혹은 건물 등의 직선적인 형태의 이미지를 재구성하기에 적합합니다. [스테이블 디퓨전 : 인테리어 및 건물 묘사에 활용하기](https://ai-designer-allan.tistory.com/entry/%EC%8A%A4%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%94%94%ED%93%A8%EC%A0%84-%EC%9D%B8%ED%85%8C%EB%A6%AC%EC%96%B4-%EB%B0%8F-%EA%B1%B4%EB%AC%BC-%EB%AC%98%EC%82%AC%EC%97%90-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0) [ 스테이블 디퓨전 : 인테리어 및 건물 묘사에 활용하기 건물 디자인 및 인테리어에 최적화된 컨트롤넷 Mlsd의 사용방법에 대해서 알아봅니다. 안녕하세요 Allan입니다. 이번 포스팅 주제는 컨트롤넷의 종류 중 하나인 mlsd입니다. ControlNet의 종류나 사용 ai-designer-allan.tistory.com ](https://ai-designer-allan.tistory.com/entry/%EC%8A%A4%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%94%94%ED%93%A8%EC%A0%84-%EC%9D%B8%ED%85%8C%EB%A6%AC%EC%96%B4-%EB%B0%8F-%EA%B1%B4%EB%AC%BC-%EB%AC%98%EC%82%AC%EC%97%90-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0)![](https://scrap.kakaocdn.net/dn/kBgLy/hyR5qlkX8z/WoKeoFlR2zXW7ra4Mj88U0/img.png?width=400&height=600&face=0_0_400_600,https://scrap.kakaocdn.net/dn/2asKp/hyR5xdJFgM/k2gu8f2tliih9OmijApFlK/img.png?width=400&height=600&face=0_0_400_600,https://scrap.kakaocdn.net/dn/gPMiU/hyR5lj77Pc/diu9akNfcpTruo8LN6tpd1/img.jpg?width=3672&height=5508&face=0_0_3672_5508) ### [5\. Normal](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#5.%20Normal-1) ![Normal](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FnE3yj%2Fbtr4l11fueH%2FRZbCAeYOs6cwDrhO9DKGmK%2Fimg.png) Normal map이라고 하는데 Depth와 비슷한 기능을 합니다. 구도와 입체감등을 재현하는데 적합합니다. Depth와의 차이점이 있다면 Normal은 피사체의 입체감을 표현하는 데에 더 강하고 Depth는 피사체의 입체감을 표현하는 데에는 Normal보다 약하지만 주위 배경의 입체감까지 상세하게 표현해 주는 result를 생성해 줍니다. ### [6\. OpenPose](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#6.%20OpenPose%C2%A0-1)  ![OpenPose](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FWEq5q%2Fbtr4iTbNLtk%2FembOkUC69fqVkvB5UTzdYK%2Fimg.png) Openpose는 가장 많이 이용되는 ControlNet입니다. 보시는 것처럼 기반이 되는 이미지에서 자세를 막대기형태로 구현한 result을 생성합니다. 원하는 자세를 구현하는데 적합합니다.  개인적으로 Depth나 Normal이 좀 더 성능이 좋은 것 같긴 합니다. Openpose 사용방법에 대한 글은 게시물 상단 링크에 있으니 참고하시는 것을 추천드립니다! ### [7\. Scribble](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#7.%20Scribble-1) ![Scribble](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FBUByh%2Fbtr4jKezwgF%2FhgGBlJZnmVnGjPEyLWWyek%2Fimg.png) 그림판에서 그린 그림을 기반으로 이미지를 생성할 수 있습니다. 그림 잘 그리시는 분들만 이용하시는 것을 추천드립니다. 조금 재밌을 것 같기도 하네요. ### [8\. Segmentation](https://ai-designer-allan.tistory.com/entry/webui-ControlNet%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%84%B7-%EB%8B%A4%EC%9A%B4%EA%B8%B0%EB%8A%A5%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95%EC%A2%85%EB%A5%98%EC%84%A4%EC%B9%98%EB%B0%A9%EB%B2%95#8.%20Segmentation-1) ![Segmentation](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fl4DEW%2Fbtr4ifMJt4a%2FU0N7jXOK9yhQtZtXwf2DKK%2Fimg.png) 색을 분리해서 result을 생성합니다. 아직은 성능이 그닥이라고 하니 다른 ControlNet을 사용하시는 것을 추천드립니다. 이렇게 해서  Controlnet에 대해 처음부터 끝까지 알아보았습니다. 위에서 말씀드린 대로 각각 사용방법은 차차 포스팅할 예정이니  즐겨찾기 해두시고 자주 놀러 와 주시면 감사하겠습니다.